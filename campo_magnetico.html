<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o Interativa de Campo Magn√©tico</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f9;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        
        /* Avatar Container */
        #avatar-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        #avatar {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
            flex-shrink: 0;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        #narration-box {
            flex: 1;
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 10px;
            position: relative;
        }
        
        #narration-box::before {
            content: '';
            position: absolute;
            left: -15px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 15px solid transparent;
            border-bottom: 15px solid transparent;
            border-right: 15px solid rgba(255,255,255,0.95);
        }
        
        #narration-text {
            font-size: 16px;
            color: #333;
            line-height: 1.6;
            margin: 0 0 15px 0;
            min-height: 60px;
        }
        
        #narration-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .control-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        #play-btn {
            background: #4CAF50;
            color: white;
        }
        
        #play-btn:hover {
            background: #45a049;
        }
        
        #pause-btn {
            background: #ff9800;
            color: white;
        }
        
        #pause-btn:hover {
            background: #e68900;
        }
        
        #restart-btn {
            background: #2196F3;
            color: white;
        }
        
        #restart-btn:hover {
            background: #0b7dda;
        }
        
        #progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        #progress-fill {
            height: 100%;
            background: #667eea;
            width: 0%;
            transition: width 0.3s;
        }
        
        .speaking {
            animation: pulse 1s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        #main-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            align-items: flex-start;
        }
        #flowchart {
            width: 350px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #flowchart h2 {
            color: #9c27b0;
            margin-top: 0;
            font-size: 1.3em;
        }
        .flow-step {
            margin: 15px 0;
            padding: 12px;
            border-left: 4px solid #9c27b0;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .flow-step h3 {
            margin: 0 0 8px 0;
            color: #9c27b0;
            font-size: 1em;
        }
        .flow-step p {
            margin: 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .formula {
            background-color: #e9ecef;
            padding: 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            margin: 8px 0;
            font-size: 0.85em;
        }
        .arrow {
            text-align: center;
            color: #9c27b0;
            font-size: 1.5em;
            margin: 5px 0;
        }
        #simulation-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #controls {
            margin-top: 20px;
            width: 600px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
        }
        .current-value {
            font-weight: bold;
            color: #9c27b0;
        }
        .info-box {
            background-color: #e1bee7;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    
    <h1>Simula√ß√£o Interativa de Campo Magn√©tico</h1>
    
    <!-- Avatar Narrador -->
    <div id="avatar-container">
        <div id="avatar">üë®‚Äçüî¨</div>
        <div id="narration-box">
            <p id="narration-text">Ol√°! Sou o Professor Magneto e vou gui√°-lo nesta simula√ß√£o interativa de campos magn√©ticos!</p>
            <div id="narration-controls">
                <button id="play-btn" class="control-btn">‚ñ∂ Iniciar</button>
                <button id="pause-btn" class="control-btn" style="display:none;">‚è∏ Pausar</button>
                <button id="restart-btn" class="control-btn">‚Üª Reiniciar</button>
                <div id="progress-bar">
                    <div id="progress-fill"></div>
                </div>
            </div>
        </div>
    </div>
    
    <p>Arraste os fios na tela para mudar a posi√ß√£o e use os controles para alterar a corrente el√©trica.</p>
    
    <div id="main-container">
        <!-- Fluxograma Did√°tico -->
        <div id="flowchart">
            <h2>üß≤ Como Funciona a Simula√ß√£o</h2>
            
            <div class="flow-step">
                <h3>1Ô∏è‚É£ Inicializa√ß√£o</h3>
                <p>Sistema cria dois fios condutores com correntes el√©tricas em posi√ß√µes iniciais</p>
            </div>
            
            <div class="arrow">‚Üì</div>
            
            <div class="flow-step">
                <h3>2Ô∏è‚É£ Intera√ß√£o do Usu√°rio</h3>
                <p><strong>Arrastar:</strong> Clique e arraste os fios para mudar posi√ß√£o</p>
                <p><strong>Sliders:</strong> Ajuste a corrente el√©trica (-5A a +5A)</p>
            </div>
            
            <div class="arrow">‚Üì</div>
            
            <div class="flow-step">
                <h3>3Ô∏è‚É£ C√°lculo do Campo</h3>
                <p>Para cada ponto da grade (25√ó25 pontos):</p>
                <div class="formula">
                    B‚Éó = Œ£ (Œº‚ÇÄ¬∑I / 2œÄ¬∑r) ¬∑ Œ∏ÃÇ
                </div>
                <p style="font-size: 0.85em; color: #666;">
                    <strong>Lei de Biot-Savart (fio infinito)</strong><br>
                    <strong>r:</strong> dist√¢ncia ao fio<br>
                    <strong>I:</strong> corrente el√©trica<br>
                    <strong>Œ∏ÃÇ:</strong> dire√ß√£o tangencial (regra da m√£o direita)
                </p>
            </div>
            
            <div class="arrow">‚Üì</div>
            
            <div class="flow-step">
                <h3>4Ô∏è‚É£ Visualiza√ß√£o</h3>
                <p><strong>Vetores:</strong> Setas mostram dire√ß√£o e intensidade do campo</p>
                <p><strong>Cor das setas:</strong> Magenta = campo mais forte</p>
                <p><strong>Fios:</strong> Verde (corrente saindo ‚äô) / Laranja (corrente entrando ‚äó)</p>
            </div>
            
            <div class="arrow">‚Üì</div>
            
            <div class="flow-step">
                <h3>5Ô∏è‚É£ Atualiza√ß√£o Cont√≠nua</h3>
                <p>O sistema recalcula tudo 60 vezes por segundo, criando uma anima√ß√£o fluida e responsiva</p>
            </div>

            <div class="info-box">
                <strong>üí° Regra da M√£o Direita:</strong><br>
                Polegar = dire√ß√£o da corrente<br>
                Dedos curvados = sentido do campo magn√©tico
            </div>
        </div>

        <!-- Simula√ß√£o e Controles -->
        <div>
            <div id="simulation-container"></div>
            
            <div id="controls">
                <h2>Controles dos Fios Condutores</h2>
                
                <div class="control-group">
                    <label for="slider_i1">Corrente I1 (A): <span id="i1_display" class="current-value">2.0</span></label>
                    <input type="range" id="slider_i1" min="-5" max="5" step="0.1" value="2.0">
                    <small>Positivo = corrente saindo da tela (‚äô) | Negativo = corrente entrando na tela (‚äó)</small>
                </div>

                <div class="control-group">
                    <label for="slider_i2">Corrente I2 (A): <span id="i2_display" class="current-value">-2.0</span></label>
                    <input type="range" id="slider_i2" min="-5" max="5" step="0.1" value="-2.0">
                    <small>Positivo = corrente saindo da tela (‚äô) | Negativo = corrente entrando na tela (‚äó)</small>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ===================================================================================
        // SISTEMA DE NARRA√á√ÉO COM VOZ
        // ===================================================================================
        
        const narrationScript = [
            "Ol√°! Sou o Professor Magneto e vou gui√°-lo nesta simula√ß√£o interativa de campos magn√©ticos!",
            "Nesta simula√ß√£o, voc√™ ver√° como funciona o campo magn√©tico gerado por fios condutores com corrente el√©trica.",
            "Observe os dois fios condutores na tela. O fio verde representa corrente saindo da tela, marcado com o s√≠mbolo de ponto. O fio laranja representa corrente entrando na tela, marcado com uma cruz.",
            "As setas em magenta mostram o campo magn√©tico resultante. Quanto mais forte o campo, mais intensa a cor das setas.",
            "Voc√™ pode arrastar os fios clicando e movendo-os pela tela. Observe como o padr√£o do campo magn√©tico muda conforme voc√™ move os fios!",
            "Use os controles deslizantes abaixo da simula√ß√£o para ajustar a intensidade da corrente el√©trica em cada fio, de menos 5 at√© mais 5 amp√®res.",
            "Quando a corrente √© positiva, ela sai da tela. Quando √© negativa, ela entra na tela. Experimente inverter as correntes e veja o que acontece!",
            "O c√°lculo do campo magn√©tico usa a Lei de Biot-Savart. Para cada ponto do espa√ßo, calculamos a contribui√ß√£o de cada fio e somamos os vetores.",
            "A dire√ß√£o do campo magn√©tico segue a regra da m√£o direita: aponte o polegar na dire√ß√£o da corrente e seus dedos curvados indicam o sentido do campo.",
            "Agora √© sua vez! Experimente mover os fios e alterar as correntes. Observe como campos magn√©ticos de mesmo sentido se repelem e de sentidos opostos se atraem.",
            "Divirta-se explorando o fascinante mundo do eletromagnetismo! Se precisar ouvir a explica√ß√£o novamente, clique em Reiniciar."
        ];
        
        let currentNarrationIndex = 0;
        let isNarrating = false;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        
        function updateNarrationText(index) {
            const narrationText = document.getElementById('narration-text');
            const avatar = document.getElementById('avatar');
            const progressFill = document.getElementById('progress-fill');
            
            if (index < narrationScript.length) {
                narrationText.textContent = narrationScript[index];
                avatar.classList.add('speaking');
                
                // Atualiza barra de progresso
                const progress = ((index + 1) / narrationScript.length) * 100;
                progressFill.style.width = progress + '%';
                
                // S√≠ntese de voz
                if (speechSynthesis) {
                    // Cancela qualquer fala anterior
                    speechSynthesis.cancel();
                    
                    currentUtterance = new SpeechSynthesisUtterance(narrationScript[index]);
                    currentUtterance.lang = 'pt-BR';
                    currentUtterance.rate = 0.85; // Velocidade confort√°vel
                    currentUtterance.pitch = 1.0;
                    
                    // Tenta usar voz masculina em portugu√™s
                    const voices = speechSynthesis.getVoices();
                    const ptVoice = voices.find(voice => 
                        voice.lang.startsWith('pt') && 
                        (voice.name.includes('Male') || voice.name.includes('Masculino') || !voice.name.includes('Female'))
                    ) || voices.find(voice => voice.lang.startsWith('pt'));
                    
                    if (ptVoice) {
                        currentUtterance.voice = ptVoice;
                    }
                    
                    // Quando terminar de falar, aguarda 1 segundo e passa para a pr√≥xima
                    currentUtterance.onend = function() {
                        avatar.classList.remove('speaking');
                        
                        if (isNarrating && currentNarrationIndex < narrationScript.length - 1) {
                            setTimeout(() => {
                                if (isNarrating) {
                                    currentNarrationIndex++;
                                    updateNarrationText(currentNarrationIndex);
                                }
                            }, 1000); // 1 segundo de pausa entre falas
                        } else {
                            stopNarration();
                        }
                    };
                    
                    speechSynthesis.speak(currentUtterance);
                }
            } else {
                avatar.classList.remove('speaking');
                stopNarration();
            }
        }
        
        function startNarration() {
            if (isNarrating) return;
            
            isNarrating = true;
            document.getElementById('play-btn').style.display = 'none';
            document.getElementById('pause-btn').style.display = 'inline-block';
            
            updateNarrationText(currentNarrationIndex);
        }
        
        function pauseNarration() {
            isNarrating = false;
            if (speechSynthesis) {
                speechSynthesis.cancel();
            }
            document.getElementById('avatar').classList.remove('speaking');
            document.getElementById('play-btn').style.display = 'inline-block';
            document.getElementById('pause-btn').style.display = 'none';
        }
        
        function stopNarration() {
            pauseNarration();
            document.getElementById('progress-fill').style.width = '100%';
        }
        
        function restartNarration() {
            pauseNarration();
            currentNarrationIndex = 0;
            document.getElementById('progress-fill').style.width = '0%';
            updateNarrationText(0);
            setTimeout(() => startNarration(), 500);
        }
        
        // Event Listeners
        document.getElementById('play-btn').addEventListener('click', startNarration);
        document.getElementById('pause-btn').addEventListener('click', pauseNarration);
        document.getElementById('restart-btn').addEventListener('click', restartNarration);
        
        // Carrega vozes quando dispon√≠veis
        if (speechSynthesis) {
            speechSynthesis.onvoiceschanged = function() {
                speechSynthesis.getVoices();
            };
        }
        
        // ===================================================================================
        // VARI√ÅVEIS DE SIMULA√á√ÉO E FUN√á√ïES B√ÅSICAS
        // ===================================================================================
        
        const CANVAS_SIZE = 600;
        const GRID_DENSITY = 25;
        const MU_0_SCALE = 3000;
        
        let wires = [];
        let selectedWire = null;

        class Wire {
            constructor(I, x, y, name) {
                this.I = I;
                this.x = x;
                this.y = y;
                this.name = name;
                this.radius = 15;
            }
        }
        
        function calculateMagneticField(r, wires) {
            let Bx = 0;
            let By = 0;

            for (let wire of wires) {
                let Rx = r.x - wire.x;
                let Ry = r.y - wire.y;
                let r_squared = Rx * Rx + Ry * Ry;
                
                const MIN_DISTANCE_SQUARED = 100;
                if (r_squared < MIN_DISTANCE_SQUARED) {
                    continue;
                }

                let r_mag = Math.sqrt(r_squared);
                let B_mag = MU_0_SCALE * wire.I / r_mag;
                let perp_x = -Ry / r_mag;
                let perp_y = Rx / r_mag;

                Bx += B_mag * perp_x;
                By += B_mag * perp_y;
            }

            return createVector(Bx, By);
        }
        
        function setup() {
            let canvas = createCanvas(CANVAS_SIZE, CANVAS_SIZE);
            canvas.parent('simulation-container');
            canvas.mousePressed(onMousePressed);
            canvas.mouseReleased(onMouseReleased);

            wires.push(new Wire(2.0, CANVAS_SIZE * 0.3, CANVAS_SIZE * 0.5, "I1"));
            wires.push(new Wire(-2.0, CANVAS_SIZE * 0.7, CANVAS_SIZE * 0.5, "I2"));

            document.getElementById('slider_i1').oninput = updateWireCurrent;
            document.getElementById('slider_i2').oninput = updateWireCurrent;
            updateWireCurrent();
        }

        function draw() {
            background(255);

            if (selectedWire) {
                selectedWire.x = mouseX;
                selectedWire.y = mouseY;
            }
            
            drawMagneticField();
            drawWires();
        }

        function drawMagneticField() {
            for (let i = 0; i < GRID_DENSITY; i++) {
                for (let j = 0; j < GRID_DENSITY; j++) {
                    let x = map(i, 0, GRID_DENSITY - 1, 0, CANVAS_SIZE);
                    let y = map(j, 0, GRID_DENSITY - 1, 0, CANVAS_SIZE);
                    let r = createVector(x, y);
                    let B = calculateMagneticField(r, wires);
                    let B_mag = B.mag();

                    let color_scale = map(B_mag, 0, 5, 100, 255);
                    stroke(color_scale, 0, color_scale, 180);
                    strokeWeight(1.5);
                    
                    if (B_mag > 0.01) {
                        B.normalize();
                        let arrow_length = 20;

                        push();
                        translate(x, y);
                        rotate(B.heading());
                        line(0, 0, arrow_length, 0);
                        line(arrow_length, 0, arrow_length - 5, -3);
                        line(arrow_length, 0, arrow_length - 5, 3);
                        pop();
                    }
                }
            }
        }
        
        function drawWires() {
            for (let wire of wires) {
                if (wire.I > 0) {
                    fill(0, 200, 0, 220);
                    stroke(0, 100, 0);
                } else if (wire.I < 0) {
                    fill(255, 140, 0, 220);
                    stroke(200, 100, 0);
                } else {
                    fill(150);
                    stroke(100);
                }
                
                wire.radius = 15 + 5 * Math.abs(wire.I);
                strokeWeight(3);
                ellipse(wire.x, wire.y, wire.radius * 2);

                fill(255);
                textAlign(CENTER, CENTER);
                textSize(20);
                if (wire.I > 0) {
                    text("‚äô", wire.x, wire.y - 2);
                } else if (wire.I < 0) {
                    text("‚äó", wire.x, wire.y - 2);
                }

                fill(0);
                textSize(11);
                text(wire.name, wire.x, wire.y + wire.radius + 12);
                text(wire.I.toFixed(1) + "A", wire.x, wire.y + wire.radius + 25);
            }
        }

        function onMousePressed() {
            for (let wire of wires) {
                let d = dist(mouseX, mouseY, wire.x, wire.y);
                if (d < wire.radius) {
                    selectedWire = wire;
                    break;
                }
            }
        }

        function onMouseReleased() {
            selectedWire = null;
        }

        function updateWireCurrent() {
            const slider1 = document.getElementById('slider_i1');
            const slider2 = document.getElementById('slider_i2');
            
            wires[0].I = parseFloat(slider1.value);
            wires[1].I = parseFloat(slider2.value);

            document.getElementById('i1_display').innerText = wires[0].I.toFixed(1);
            document.getElementById('i2_display').innerText = wires[1].I.toFixed(1);
        }

    </script>
</body>
</html>
